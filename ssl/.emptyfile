server {
    listen 443 ssl;
    server_name dev1.wanderer.deadly-w.space;

    ssl_certificate ~/work/prod/dev1/wanderer-production/ssl/certificate.crt;
    ssl_certificate_key ~/work/prod/dev1/wanderer-production/ssl/private.key;

    location / {
        proxy_pass https://localhost:2001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

$SERVER["socket"] == ":443" {
    ssl.engine = "enable"
    ssl.pemfile = "/home/wnduser/work/prod/dev1/wanderer-production/ssl/pemfile.pem"
    ssl.ca-file = "/home/wnduser/work/prod/dev1/wanderer-production/ssl/ca_bundle.crt"
    $HTTP["host"] == "dev1.wanderer.deadly-w.space" {
        proxy.server = ( "" => ( ( "host" => "127.0.0.1", "port" => 2001 ) ) )
    }
    $HTTP["host"] !~ "^(dev1\.wanderer\.deadly-w\.space|dev2\.wanderer\.deadly-w\.space)$" {
        url.access-deny = ( "" )
    }
}

$SERVER["socket"] == ":443" {
    ssl.engine = "enable"
    ssl.pemfile = "/home/wnduser/work/prod/dev2/wanderer-production/ssl/pemfile.pem"
    ssl.ca-file = "/home/wnduser/work/prod/dev2/wanderer-production/ssl/ca_bundle.crt"
    $HTTP["host"] == "dev2.wanderer.deadly-w.space" {
        proxy.server = ( "" => ( ( "host" => "127.0.0.1", "port" => 2002 ) ) )
    }
    $HTTP["host"] !~ "^(dev1\.wanderer\.deadly-w\.space|dev2\.wanderer\.deadly-w\.space)$" {
        url.access-deny = ( "" )
    }
}

$HTTP["host"] !~ "^(dev1\.wanderer\.deadly-w\.space|dev2\.wanderer\.deadly-w\.space)$" {
    url.access-deny = ( "" )
}